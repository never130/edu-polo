{% extends 'dashboard/base_dashboard.html' %}
{% load static %}
{% load l10n %}

{% block title %}Editar Usuario - Admin{% endblock %}

{% block user_role %}Administrador{% endblock %}

{% block sidebar_menu %}
<li><a href="{% url 'dashboard_admin' %}"><i class="fa-solid fa-home"></i> Inicio</a></li>
{% if es_admin_completo %}
<li><a href="{% url 'administracion:panel_cursos' %}"><i class="fa-solid fa-book"></i> Gestión Cursos</a></li>
<li><a href="{% url 'administracion:panel_comisiones' %}"><i class="fa-solid fa-users-rectangle"></i> Gestión Comisiones</a></li>
{% endif %}
<li><a href="{% url 'administracion:panel_inscripciones' %}"><i class="fa-solid fa-clipboard-list"></i> Inscripciones</a></li>
<li><a href="{% url 'empresas:mesa_entrada_list' %}"><i class="fa-solid fa-building"></i> Solicitudes Empresas</a></li>
<li><a href="{% url 'empresas:gestion_empresas' %}"><i class="fa-solid fa-building"></i> Gestión Empresas</a></li>
{% if es_admin_completo %}
<li><a href="{% url 'administracion:gestion_usuarios' %}" class="active"><i class="fa-solid fa-users-cog"></i> Gestión Usuarios</a></li>
{% endif %}
<li><a href="{% url 'administracion:buscador_estudiantes' %}"><i class="fa-solid fa-search"></i> Buscar Estudiantes</a></li>
{% if es_admin_completo %}
<li><a href="{% url 'administracion:panel_polos' %}"><i class="fa-solid fa-map-marker-alt"></i> Polos</a></li>
{% endif %}
{% if es_admin_completo %}
<li><a href="{% url 'administracion:estadisticas' %}"><i class="fa-solid fa-chart-bar"></i> Estadísticas</a></li>
{% endif %}
<li><a href="{% url 'administracion:panel_asistencia' %}"><i class="fa-solid fa-calendar-check"></i> Asistencias</a></li>
{% if es_admin_completo %}
<li><a href="{% url 'administracion:docentes_cursos' %}"><i class="fa-solid fa-chalkboard-teacher"></i> Docentes y Cursos</a></li>
{% endif %}
<li><a href="{% url 'usuario:mi_perfil' %}"><i class="fa-solid fa-user"></i> Mi Perfil</a></li>
{% if es_admin_completo %}
<li><a href="{% url 'admin:index' %}"><i class="fa-solid fa-cogs"></i> Django Admin</a></li>
{% endif %}
{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Editar Usuario</h2>
    <p>Modifica los datos de: <strong>{{ persona.nombre_completo }}</strong></p>
</div>

{% if messages %}
    <ul class="messages">
        {% for message in messages %}
            <li class="{{ message.tags }}">{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}

<div class="form-card">
    <div class="info-badge">
        <strong>Roles actuales:</strong> {{ roles_actuales }}
    </div>
    
    <form method="post">
        {% csrf_token %}
        
        <!-- Información Personal -->
        <div class="form-section">
            <h3 class="section-title">
                Información Personal
            </h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="dni">DNI (No editable)</label>
                    <input type="text" value="{{ persona.dni|unlocalize }}" disabled>
                </div>
                <div class="form-group">
                    <label for="contrasena">Nueva Contraseña (Dejar vacío para no cambiar)</label>
                    <input type="password" name="contrasena" id="contrasena" placeholder="Mínimo 6 caracteres" minlength="6">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="nombre" class="required">Nombre</label>
                    <input type="text" name="nombre" id="nombre" value="{{ persona.nombre }}" required>
                </div>
                <div class="form-group">
                    <label for="apellido" class="required">Apellido</label>
                    <input type="text" name="apellido" id="apellido" value="{{ persona.apellido }}" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="correo" class="required">Correo Electrónico</label>
                    <input type="email" name="correo" id="correo" value="{{ persona.correo }}" required>
                </div>
                <div class="form-group">
                    <label for="telefono">Teléfono</label>
                    <input type="tel" name="telefono" id="telefono" value="{{ persona.telefono|default:''|unlocalize }}">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="fecha_nacimiento">Fecha de Nacimiento</label>
                    <input type="date" name="fecha_nacimiento" id="fecha_nacimiento" value="{{ persona.fecha_nacimiento|date:'Y-m-d'|default:'' }}">
                </div>
                <div class="form-group">
                    <label for="genero">Género</label>
                    <select name="genero" id="genero">
                        <option value="">Selecciona una opción</option>
                        <option value="M" {% if persona.genero == 'M' %}selected{% endif %}>Masculino</option>
                        <option value="F" {% if persona.genero == 'F' %}selected{% endif %}>Femenino</option>
                        <option value="O" {% if persona.genero == 'O' %}selected{% endif %}>Otro</option>
                        <option value="P" {% if persona.genero == 'P' %}selected{% endif %}>Prefiero no decirlo</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Residencia -->
        <div class="form-section">
            <h3 class="section-title">
                Información de Residencia
            </h3>
            <div class="form-group">
                <label for="ciudad_residencia">Ciudad</label>
                <select name="ciudad_residencia" id="ciudad_residencia">
                    <option value="">Selecciona una ciudad</option>
                    <option value="Ushuaia" {% if persona.ciudad_residencia == 'Ushuaia' %}selected{% endif %}>Ushuaia</option>
                    <option value="Rio Grande" {% if persona.ciudad_residencia == 'Rio Grande' %}selected{% endif %}>Río Grande</option>
                    <option value="Tolhuin" {% if persona.ciudad_residencia == 'Tolhuin' %}selected{% endif %}>Tolhuin</option>
                </select>
            </div>
        </div>
        
        {% if puede_cambiar_rol %}
        <!-- Gestión de Roles -->
        <div class="form-section">
            <h3 class="section-title">
                Cambiar Rol del Usuario
            </h3>
            <div class="form-group">
                <label for="nuevo_rol">Nuevo Rol (Opcional - Dejar vacío para mantener el actual)</label>
                <select name="nuevo_rol" id="nuevo_rol">
                    <option value="">Mantener rol actual</option>
                    <option value="estudiante">Estudiante</option>
                    <!-- <option value="docente">Docente</option> OCULTO TEMPORALMENTE -->
                    <option value="admin">Administrador</option>
                    <option value="mesa_entrada">Mesa de Entrada</option>
                </select>
                <small style="color: #64748b; display: block; margin-top: 0.5rem;">
                    Al cambiar el rol, se eliminarán los roles y perfiles anteriores del usuario.
                </small>
            </div>
        </div>
        {% endif %}
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                Guardar Cambios
            </button>
            <a href="{% url 'administracion:gestion_usuarios' %}" class="btn btn-secondary">Cancelar
            </a>
        </div>
    </form>
</div>

<style>
    .page-header {
        margin-bottom: 2rem;
    }
    .page-header h2 {
        font-size: 2.2rem;
        color: #334155;
        margin-bottom: 0.5rem;
    }
    .page-header p {
        color: #64748b;
        font-size: 1.05rem;
    }
    
    .messages {
        list-style: none;
        padding: 0;
        margin-bottom: 1.5rem;
    }
    .messages li {
        padding: 1rem 1.5rem;
        border-radius: 10px;
        margin-bottom: 0.5rem;
        font-weight: 600;
    }
    .messages li.success {
        background: #d1fae5;
        color: #065f46;
    }
    .messages li.error {
        background: #fee2e2;
        color: #991b1b;
    }
    
    .form-card {
        background: white;
        padding: 2.5rem;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        max-width: 900px;
        margin: 0 auto;
    }
    
    .info-badge {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        font-size: 1.05rem;
    }
    
    .form-section {
        margin-bottom: 2.5rem;
        padding-bottom: 2rem;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .form-section:last-of-type {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }
    
    .section-title {
        font-size: 1.5rem;
        color: #6366f1;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.8rem;
        font-weight: 700;
    }
    
    .form-row {
        display: flex;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .form-row .form-group {
        flex: 1;
        margin-bottom: 0;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 0.6rem;
        color: #334155;
        font-weight: 600;
        font-size: 0.95rem;
    }
    
    .form-group label.required::after {
        content: ' *';
        color: #ef4444;
        margin-left: 4px;
    }
    
    .form-group input[type="text"],
    .form-group input[type="email"],
    .form-group input[type="tel"],
    .form-group input[type="date"],
    .form-group input[type="password"],
    .form-group select {
        width: 100%;
        padding: 1rem 1.2rem;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: #f8fafc;
        font-family: 'Be Vietnam Pro', sans-serif;
    }
    
    .form-group input:disabled {
        background: #e2e8f0;
        cursor: not-allowed;
        color: #64748b;
    }
    
    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: #6366f1;
        background: white;
        box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
    }
    
    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        margin-top: 2.5rem;
    }
    
    .btn {
        padding: 1rem 2rem;
        border-radius: 12px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        cursor: pointer;
        border: none;
        font-size: 1rem;
        display: inline-block;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
    }
    
    .btn-secondary {
        background: #e2e8f0;
        color: #334155;
    }
    
    .btn-secondary:hover {
        background: #cbd5e1;
    }
    
    @media (max-width: 768px) {
        .form-row {
            flex-direction: column;
            gap: 0;
        }
        
        .form-card {
            padding: 1.5rem;
            margin: 1rem;
        }
        
        .section-title {
            font-size: 1.3rem;
        }
        
        .form-group input,
        .form-group select {
            padding: 0.8rem 1rem;
        }
        
        .btn {
            padding: 0.8rem 1.5rem;
            font-size: 0.9rem;
        }
        
        .form-actions {
            flex-direction: column;
            gap: 0.8rem;
        }
        
        .form-actions .btn {
            width: 100%;
        }
    }
</style>
{% endblock %}



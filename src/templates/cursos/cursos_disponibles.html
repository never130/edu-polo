{% extends 'dashboard/base_dashboard.html' %}
{% load static %}
{% load l10n %}

{% block title %}Cursos Disponibles{% endblock %}

{% block scripts %}
<script>
    function toggleDescripcion(id, btn) {
        const desc = document.getElementById(id);
        if (!desc || !btn) return;

        const expanded = desc.classList.toggle('expanded');

        if (expanded) {
            desc.style.display = 'block';
            desc.style.overflow = 'visible';
            desc.style.maxHeight = 'none';
            desc.style.webkitLineClamp = 'unset';
        } else {
            desc.style.display = '-webkit-box';
            desc.style.overflow = 'hidden';
            desc.style.maxHeight = '';
            desc.style.webkitLineClamp = '2';
        }

        btn.textContent = expanded ? 'Ver menos' : 'Ver m√°s';
    }
</script>

<script>
(function () {
    function stableSeed(input) {
        const str = String(input || '').toLowerCase();
        let h = 2166136261;
        for (let i = 0; i < str.length; i++) {
            h ^= str.charCodeAt(i);
            h = Math.imul(h, 16777619);
        }
        return (h >>> 0) % 1000000000;
    }

    function normalizeText(input) {
        return String(input || '')
            .toLowerCase()
            .normalize('NFD')
            .replace(/[\u0300-\u036f]/g, '')
            .trim();
    }

    function chooseBasePrompt(courseName) {
        const n = normalizeText(courseName);

        if (n.includes('stop motion') || n.includes('stopmotion')) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, animation stop motion studio desk, clay figures, mini set, camera tripod, storyboard, craft materials';
        }
        if (n.includes('mas juego') || n.includes('mas aprendo')) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, kids learning space, educational board games, puzzles, colorful manipulatives, classroom table, no faces';
        }
        if (
            n.includes('ia en el aula') ||
            ((n.includes('ia') || n.includes('inteligencia artificial')) && (n.includes('aula') || n.includes('docente') || n.includes('docentes') || n.includes('didact')))
        ) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, modern classroom teacher training workshop, teacher desk with laptop, projector, interactive whiteboard, educational materials, professional development session';
        }
        if (n.includes('archi innova') && n.includes('curiosos')) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, kids STEM corner for ages 4-7, colorful learning blocks, simple robot toys, tablets, playful safe classroom, no faces';
        }
        if (n.includes('archi innova') && n.includes('inventores')) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, kids maker electronics workshop for ages 8-12, beginner circuits, microcontroller kit, sensors, small robot prototype, laptop programming station, STEM lab, no faces';
        }
        if (n.includes('revit') || n.includes('bim')) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, architectural BIM design studio, computer screen with 3d building model, blueprint sheets, measuring tools, clean professional desk, no text';
        }
        if (
            n.includes('produccion de contenidos') ||
            n.includes('redes sociales') ||
            (n.includes('contenidos') && n.includes('redes'))
        ) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, content creation studio, smartphone on tripod, ring light, camera, editing workstation, creative desk setup, no logos, no text';
        }
        if (n.includes('analisis de datos') || (n.includes('datos') && (n.includes(' ia') || n.includes('ia ') || n.includes('inteligencia artificial')))) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, modern computer lab, dashboards and data charts on screens, AI assistant concept, clean design';
        }
        if (n.includes('chatbot') || n.includes('n8n') || n.includes('automatiz')) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, messaging chatbot concept, automation nodes and connections, modern computer lab';
        }
        if (n.includes('startup')) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, product design desk, laptop, prototype screens, sticky notes, pitch demo scene, no text';
        }
        if (n.includes('ajedrez') && (n.includes('adult') || n.includes('adultos'))) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, chess club for adults, wooden chessboard, classic pieces, analysis notebook, quiet warm lighting, no text';
        }
        if (n.includes('ajedrez') && n.includes('avanzad')) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, advanced chess analysis, chessboard midgame position, timer clock, notebooks, strategy study table, no text';
        }
        if (n.includes('ajedrez') && n.includes('inicial')) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, beginner chess lesson, chessboard with pieces, teacher hands pointing at moves, classroom table, no faces, no text';
        }
        if (n.includes('ajedrez')) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, chess learning table, chessboard and pieces, calm classroom environment, no faces, no text';
        }
        if (
            n.includes('bio fablab') ||
            n.includes('biomaterial') ||
            n.includes('bio material') ||
            n.includes('bio materiales') ||
            n.includes('biomateriales')
        ) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, bio lab workshop, sustainable biomaterials samples, petri dishes, lab glassware, natural fibers, clean scientific workspace, no labels, no text';
        }
        if (n.includes('alfabetizacion digital') || n.includes('ciudadania digital')) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, digital literacy classroom, laptops on desks, safe internet concept, icons without text, modern training room';
        }
        if (n.includes('podcast')) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, podcast studio setup, microphone, headphones, audio mixer, camera on tripod, recording desk, no logos, no text';
        }
        if (n.includes('autocad') || n.includes('sketchup') || n.includes('sketch-up') || n.includes('sketch up')) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, architecture design workstation, CAD drafting and 3d modeling on screen, blueprint sheets, measuring tools, clean professional desk, no text';
        }
        if (n.includes('robotica star') || (n.includes('robotica') && n.includes(' star'))) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, kids robotics workshop, educational robot kits, colorful sensors, small wheeled robot chassis, building blocks, safe tools, STEM lab';
        }
        if (n.includes('robotica plus') || (n.includes('robotica') && n.includes(' plus'))) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, teen robotics lab, microcontroller boards, sensors, wiring, laptop programming station, robot prototype on workbench';
        }
        if (n.includes('nivel pro') || (n.includes('robotica') && (n.includes(' pro') || n.includes('trayecto avanzado') || n.includes('avanzado')))) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, advanced robotics engineering lab, precision tools, oscilloscope, wiring harnesses, robotic arm prototype on bench, technical workshop';
        }
        if (n.includes('robot') || n.includes('robotica') || n.includes('arduino') || n.includes('sumo') || n.includes('bot')) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, robotics workshop, educational robots, gears, wires, tools, STEM lab';
        }
        if (n.includes('makers kids') || (n.includes('makers') && n.includes('kids'))) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, kids makerspace, 3d printer, colorful filament, simple CAD on tablet, craft tools, creative workshop';
        }
        if (n.includes('makers')) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, makerspace, 3d printer, tools, electronics components, creative workshop';
        }
        if (n.includes('ingl') || n.includes('idioma')) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, language learning classroom, books, flashcards, friendly learning space, no text';
        }
        if (
            n.includes('linux') ||
            n.includes('program') ||
            n.includes('desarrollo') ||
            n.includes('videojuego') ||
            n.includes('codigo') ||
            n.includes('gamer') ||
            n.includes('gaming') ||
            n.includes('game') ||
            n.includes('inteligencia artificial') ||
            /(^|\s)(ai|ia)(\s|$)/.test(n)
        ) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, modern computer lab, coding and science learning, friendly workshop scene';
        }
        if (
            n.includes('comic') ||
            n.includes('ilustracion') ||
            n.includes('historieta') ||
            n.includes('fotografia') ||
            n.includes('diseno') ||
            n.includes('arte') ||
            n.includes('animacion') ||
            n.includes('motion')
        ) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, creative studio desk, camera, drawing tools, art materials, friendly workshop';
        }
        if (n.includes('taller') || n.includes('explorador')) {
            return 'high quality 3d render, photorealistic, realistic materials, cinematic lighting, global illumination, shallow depth of field, hands-on workshop, tools, craft materials, classroom makers table';
        }

        return null;
    }

    const DEFAULT_COURSE_IMAGE_URL = 'https://image.pollinations.ai/prompt/3d%20render%20cartoon%20friendly%20student%20using%20smartphone%20and%20laptop%20digital%20citizenship%20online%20safety%20privacy%20shield%20icons%20social%20media%20colorful%20soft%20lighting?width=600&height=400&nologo=true';

    function buildPollinationsUrl(name, desc) {
        const cleanName = (name || '').trim();
        const base = chooseBasePrompt(cleanName);
        if (!base) return DEFAULT_COURSE_IMAGE_URL;
        const extra = cleanName;
        const suffix = 'no text, no watermark, no logo, no letters, no words, not cartoon, not illustration, not anime';
        const prompt = extra ? `${base}, ${extra}, ${suffix}` : `${base}, ${suffix}`;
        const seed = stableSeed(cleanName || base);
        return `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=600&height=400&seed=${seed}&nologo=true`;
    }

    function preloadAndSet(img, url) {
        if (!url) return;
        const probe = new Image();
        probe.referrerPolicy = 'no-referrer';
        probe.onload = () => {
            img.src = url;
        };
        probe.onerror = () => {
        };
        probe.src = url;
    }

    function apply() {
        document.querySelectorAll('img.js-pollinations-course-img').forEach((img) => {
            img.referrerPolicy = 'no-referrer';
            const name = img.getAttribute('data-course-name') || img.alt || '';
            const desc = img.getAttribute('data-course-desc') || '';
            const url = buildPollinationsUrl(name, desc);
            preloadAndSet(img, url);
        });
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', apply);
    } else {
        apply();
    }
})();
</script>
{% endblock %}

{% block sidebar_menu %}
<li><a href="{% url 'dashboard_estudiante' %}"><i class="fa-solid fa-home"></i> Inicio</a></li>
<li><a href="{% url 'cursos:ver_disponibles' %}" class="active"><i class="fa-solid fa-book-open"></i> Cursos Disponibles</a></li>
<li><a href="{% url 'cursos:mis_inscripciones' %}"><i class="fa-solid fa-graduation-cap"></i> Mis Inscripciones</a></li>
<li><a href="{% url 'usuario:gestionar_tutores' %}"><i class="fa-solid fa-chalkboard-teacher"></i> Mis Tutores</a></li>
<li><a href="{% url 'usuario:mi_progreso' %}"><i class="fa-solid fa-chart-line"></i> Mi Progreso</a></li>
{# <li><a href="{% url 'usuario:mis_certificados' %}"><i class="fa-solid fa-certificate"></i> Certificados</a></li> #}
<li><a href="{% url 'usuario:mi_perfil' %}"><i class="fa-solid fa-user"></i> Mi Perfil</a></li>
{% endblock %}

{% block content %}
<style>
    .page-header {
        background: white;
        padding: 2.5rem;
        border-radius: 20px;
        color: #1e293b;
        margin-bottom: 2rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        border: 1px solid #e2e8f0;
    }
    
    .page-header h2 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        font-weight: 800;
        color: #1e293b;
    }

    .page-header p {
        color: #475569;
        margin: 0;
    }
    
    .cursos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.25rem;
    }
    
    .curso-card {
        background: white;
        padding: 1rem;
        border-radius: 14px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06);
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        height: 100%;
    }
    
    .curso-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        border-color: #cbd5e1;
    }

    .curso-img-container {
        height: 150px;
        background: #f1f5f9;
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 0.75rem;
    }

    .curso-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        transition: transform 0.6s ease;
    }

    .curso-card:hover .curso-img {
        transform: scale(1.05);
    }
    
    .curso-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 0.75rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid #f1f5f9;
    }
    
    .curso-icon {
        font-size: 1.5rem;
        background: #eff6ff;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        flex-shrink: 0;
    }

    .curso-title {
        min-width: 0;
    }
    
    .curso-title h3 {
        color: #1e293b;
        font-size: 1.1rem;
        font-weight: 700;
        margin: 0;
        line-height: 1.3;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .curso-estado {
        display: inline-block;
        background: #dcfce7;
        color: #166534;
        padding: 0.15rem 0.5rem;
        border-radius: 9999px;
        font-size: 0.65rem;
        font-weight: 600;
        margin-top: 0.25rem;
    }
    
    .curso-descripcion-wrapper {
        margin-bottom: 0.75rem;
        flex-grow: 1;
    }

    .curso-descripcion {
        color: #64748b;
        font-size: 0.85rem;
        line-height: 1.4;
        margin: 0;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .curso-descripcion.expanded {
        -webkit-line-clamp: unset;
        display: block;
        max-height: none;
        overflow: visible;
    }
    
    .btn-leer-mas {
        background: none;
        border: none;
        color: #3b82f6;
        font-size: 0.75rem;
        font-weight: 600;
        cursor: pointer;
        padding: 0;
        margin-top: 0.25rem;
    }
    
    .btn-leer-mas:hover {
        text-decoration: underline;
    }
    
    .curso-info-compact {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 0.75rem;
    }
    
    .info-badge {
        background: #f1f5f9;
        color: #475569;
        padding: 0.15rem 0.5rem;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .comisiones-section {
        margin-top: auto;
        padding-top: 0.5rem;
        border-top: 1px dashed #e2e8f0;
        max-height: 260px;
        overflow: auto;
    }
    
    .comisiones-titulo {
        font-size: 0.85rem;
        color: #334155;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.4rem;
        font-weight: 600;
    }
    
    .comision-compact {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 0.6rem;
        margin-bottom: 0.5rem;
        transition: all 0.2s;
    }
    
    .comision-compact:hover {
        border-color: #cbd5e1;
        background: #f1f5f9;
    }
    
    .comision-compact-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-bottom: 0.5rem;
    }
    
    .comision-id {
        font-weight: 600;
        color: #3b82f6;
        font-size: 0.85rem;
    }
    
    .cupos-badge {
        font-size: 0.75rem;
        padding: 0.15rem 0.5rem;
        border-radius: 4px;
        font-weight: 600;
    }
    
    .cupos-ok { background: #dcfce7; color: #166534; }
    .cupos-warning { background: #fef3c7; color: #92400e; }
    .cupos-error { background: #fee2e2; color: #991b1b; }
    
    .comision-details-grid {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
        font-size: 0.75rem;
        color: #64748b;
        margin-bottom: 0.6rem;
    }
    
    .detail-row {
        display: flex;
        align-items: flex-start;
        gap: 0.5rem;
        line-height: 1.4;
    }
    
    .detail-row span {
        flex-shrink: 0;
        margin-top: 0.1rem;
    }
    
    .btn-inscribir-sm {
        width: 100%;
        padding: 0.45rem;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        text-align: center;
        text-decoration: none;
        display: block;
        transition: background 0.2s;
    }
    
    .btn-inscribir-sm:hover {
        background: #2563eb;
    }
    
    .btn-inscribir-sm.disabled {
        background: #94a3b8;
        cursor: not-allowed;
    }

    @media (max-width: 640px) {
        .cursos-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<div class="page-header">
    <h2>Cursos Disponibles</h2>
    <p>Explora nuestra oferta educativa e inscr√≠bete en los cursos que te interesen</p>
</div>

{% if cursos %}
    <div class="cursos-grid">
        {% for curso in cursos %}
        {% with lower_name=curso.nombre|lower %}
        <div class="curso-card">
            <div class="curso-img-container">
                <img class="curso-img js-pollinations-course-img" alt="{{ curso.nombre }}"
                     loading="lazy"
                     referrerpolicy="no-referrer"
                     data-course-name="{{ curso.nombre|default:'' }}"
                     data-course-desc="{{ curso.descripcion|default:''|striptags|truncatechars:200 }}"
                     src="https://image.pollinations.ai/prompt/3d%20render%20cute%20kid%20friendly%20learning%20classroom%20colorful%20soft%20lighting%20playful%2C%20no%20text%2C%20no%20watermark%2C%20no%20logo?width=600&height=400&nologo=true"
                     onerror="this.onerror=null;this.src='https://image.pollinations.ai/prompt/3d%20render%20cute%20kid%20friendly%20learning%20classroom%20colorful%20soft%20lighting%20playful%2C%20no%20text%2C%20no%20watermark%2C%20no%20logo?width=600&height=400&nologo=true';" />
            </div>

            <div class="curso-header">
                <span class="curso-icon">üìñ</span>
                <div class="curso-title">
                    <h3>{{ curso.nombre }}</h3>
                    <span class="curso-estado">{{ curso.get_estado_display }}</span>
                </div>
            </div>
            
            <div class="curso-descripcion-wrapper">
                <p class="curso-descripcion" id="desc-{{ forloop.counter }}">
                    {{ curso.descripcion|default:"Curso de formaci√≥n profesional." }}
                </p>
                {% if curso.descripcion|length > 80 %}
                <button type="button" class="btn-leer-mas" onclick="toggleDescripcion('desc-{{ forloop.counter }}', this)">Ver m√°s</button>
                {% endif %}
            </div>
            
            <div class="curso-info-compact">
                {% if curso.edad_minima or curso.edad_maxima %}
                <div class="info-badge">
                    <span>üë§</span>
                    {% if curso.edad_minima and curso.edad_maxima %}
                        {{ curso.edad_minima }}-{{ curso.edad_maxima }} a√±os
                    {% elif curso.edad_minima %}
                        +{{ curso.edad_minima }} a√±os
                    {% elif curso.edad_maxima %}
                        Max {{ curso.edad_maxima }} a√±os
                    {% endif %}
                </div>
                {% endif %}
            </div>
            
            <div class="comisiones-section">
                {% if curso.comisiones_ciudad %}
                    <div style="display:flex; flex-wrap:wrap; gap:0.4rem; margin-bottom:0.75rem;">
                        <span style="background:#eef2ff; color:#3730a3; padding:0.15rem 0.55rem; border-radius:999px; font-size:0.78rem; font-weight:800;">
                            Comisiones: {{ curso.comisiones_ciudad|length }}
                        </span>
                    </div>
                    <h4 class="comisiones-titulo">üóìÔ∏è Comisiones</h4>
                    {% for comision in curso.comisiones_ciudad %}
                    <div class="comision-compact">
                        <div class="comision-compact-header">
                            <span class="comision-id">#{{ comision.id_comision }} - {{ comision.modalidad }}</span>
                            <div style="display:flex; gap:0.35rem; align-items:center; flex-wrap:wrap; justify-content:flex-end;">
                                {% if comision.estado == 'Abierta' and not comision.cupo_lleno %}
                                    <span class="cupos-badge cupos-ok">Abierta</span>
                                {% elif comision.estado == 'Abierta' and comision.cupo_lleno %}
                                    <span class="cupos-badge cupos-error">Cerrada</span>
                                {% elif comision.estado == 'Cerrada' %}
                                    <span class="cupos-badge cupos-error">Cerrada</span>
                                {% elif comision.estado == 'En proceso' %}
                                    <span class="cupos-badge cupos-warning">En proceso</span>
                                {% elif comision.estado == 'Finalizada' %}
                                    <span class="cupos-badge" style="background:#e2e8f0; color:#334155;">Finalizada</span>
                                {% endif %}

                                {% if comision.estado == 'Abierta' %}
                                    {% if comision.cupo_lleno %}
                                        <span class="cupos-badge cupos-error">Disponibles: 0/{{ comision.cupo_maximo }}</span>
                                    {% elif comision.cupos_limitados %}
                                        <span class="cupos-badge cupos-warning">Disponibles: {{ comision.cupos_disponibles }}/{{ comision.cupo_maximo }}</span>
                                    {% else %}
                                        <span class="cupos-badge cupos-ok">Disponibles: {{ comision.cupos_disponibles }}/{{ comision.cupo_maximo }}</span>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="comision-details-grid">
                            <div class="detail-row" title="Fecha de inicio">
                                <span>üìÖ</span> Inicia el {{ comision.fecha_inicio|date:"d/m"|default:"--" }}
                            </div>
                            <div class="detail-row" title="Horario">
                                <span>‚è∞</span> {{ comision.dias_horarios|default:"--" }}
                            </div>
                            {% if comision.fk_id_polo %}
                            <div class="detail-row" title="Polo">
                                <span>üè¢</span> {{ comision.fk_id_polo.nombre }}
                            </div>
                            {% endif %}
                        </div>
                        
                        {% if comision.estado == 'Abierta' and not comision.cupo_lleno %}
                            <a href="{% url 'inscripciones:formulario' comision.id_comision|unlocalize %}" class="btn-inscribir-sm">
                                Inscribirme
                            </a>
                        {% else %}
                            <button class="btn-inscribir-sm disabled" disabled>
                                {% if comision.estado != 'Abierta' %}
                                    Inscripci√≥n cerrada
                                {% else %}
                                    Cupo lleno
                                {% endif %}
                            </button>
                        {% endif %}
                    </div>
                    {% endfor %}
                {% else %}
                    <div style="text-align: center; color: #94a3b8; padding: 1rem; background: #f8fafc; border-radius: 8px; font-size: 0.9rem;">
                        Sin comisiones activas
                    </div>
                {% endif %}
            </div>
        </div>
        {% endwith %}
        {% endfor %}
    </div>
{% else %}
    <div class="no-cursos">
        <span style="font-size: 5rem;">üì≠</span>
        <h3 style="color: #3b82f6; margin: 1rem 0; font-size: 1.8rem;">No hay cursos disponibles</h3>
        <p style="color: #64748b; font-size: 1.1rem;">Vuelve pronto para ver nuestra nueva oferta educativa</p>
    </div>
{% endif %}

{% endblock %}

